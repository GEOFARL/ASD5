# “Піраміди”

### Завдання

В даній роботі необхідно розв'язати наступну задачу визначення послідовності медіан для заданого вхідного масиву. Нагадаємо, що медіаною для масиву називається елемент, який займає середнє положення у відсортованому масиві. Так, якщо кількість елементів у масиві непарна, то медіана одна та індекс її у відсортованому масиві визначається як [n/2] (де n — розмір вхідного масиву). Якщо кількість елементів у масиві парна, то медіан буде дві та їх індекси визначаються за формулами [n/2] та [n/2] + 1.

Задача формулюється наступним чином. Нехай заданий вхідний масив

```
A = [x1, ..., xN].
```

Припустимо, що елементи масиву поступають на вхід програми послідовно: в кожний момент часу розглядається новий елемент xi. Необхідно для кожного i (від 1 до N) визначити медіану підмасиву

```
A' = [x1, ..., xi]
```

тобто медіану для масиву елементів, які були отримані програмою на даний момент часу. Необхідно розв’язати цю задачу, використовуючі структури даних пірамід і так, щоб кожна медіана визначалась за час _O(log(i))_.
Цю задачу можна розв'язати, використовуючи дві піраміди (heap) наступним чином:

- Позначимо через H<sub>low</sub> незростаючу піраміду (max-heap), яка буде містити елементи меншої половини масиву (тобто такі елементи, які у відсортованому поточному елементі A' будуть розташовуватись у першій, меншій половині масиву).
- Позначимо через H<sub>high</sub> неспадну піраміду (min-heap), яка буде містити елементи більшої половини масиву (тобто такі елементи, які у відсортованому поточному елементі A' будуть розташовуватись у другій, більшій половині масиву).

Тепер розглянемо роботу процедури, яка розв'язує поставлену задачу із використанням двох наведених пірамід.
Нехай додається черговий елемент x<sub>i</sub>. На поточний момент сумарна кількість елементів, які зберігаються в обох пірамідах, становить (i-1). Наступні кроки, які ми повинні виконати:

1. Визначимо, в яку піраміду (H<sub>low</sub> або H<sub>high</sub>) потрібно додати новий елемент. Якщо x<sub>i</sub> менше ніж найбільший елемент з H<sub>low</sub> (тобто новий елемент буде розташовуватись в меншій поточній половині), то додаємо його у цю піраміду. В іншому випадку додаємо елемент в піраміду H<sub>high</sub>.
2. В кожний момент часу, тобто на кожній ітерації роботи алгоритму, повинен зберігатись наступний інваріант: кількість елементів в піраміді H<sub>low</sub> не повинна відрізнятись від кількості елементів в H<sub>high</sub> не більше ніж на одиницю. Під час виконання попереднього етапу цей інваріант може порушитись. Тому тепер необхідно відновити даний інваріант: якщо у піраміді H<sub>low</sub> елементів більше на 2 за H<sub>high</sub>, то визначаємо найбільший елемент з H<sub>low</sub> і вставляємо його у H<sub>high</sub>; якщо кількість елементів у H<sub>high</sub> більше на 2 за H<sub>low</sub>, то визначаємо найменший елемент з H<sub>high</sub> і вставляємо його у H<sub>low</sub>. Зрозуміло, що після кожної вставки нового елементу в піраміду необхідно перевіряти властивість піраміди: для H<sub>low</sub> - властивість незростаючої піраміди, для H<sub>high</sub> - властивість неспадної піраміди.
3. Визначити медіану для поточного масиву
   ```
   A' = [x1, ..., xi]:
   ```

- Якщо кількість елементів у A' парна, то після збереження інваріанту у пункті 2, кількість елементів у пірамідах <sub>Hlow</sub> та <sub>Hhigh</sub> буде рівною. Тому одна медіана буде найбільшим елементом H<sub>low</sub>, а інша медіана — найменшим елементом H<sub>high</sub>.
- Якщо кількість елементів у A' непарна, то єдина медіана буде знаходитись у тій піраміді, в якій кількість елементів буде більше (на одиницю) за кількість в іншій. Тому, якщо кількість елементів у H<sub>low</sub> більше за H<sub>high</sub>, то медіана — це найбільший елемент з H<sub>low</sub>. Інакше медіана — найменший елемент з H<sub>high</sub>.

Наведений алгоритм використовує процедури _extract_max_ незростаючої піраміди H<sub>low</sub> та _extract_min_ неспадної піраміди H<sub>high</sub>, які виконуються за час _O(logN)_, де N — розмір піраміди. Тому на кожній ітерації №i для поточного масиву

```
A' = [x1, ..., xi]
```

час роботи наведеної процедури становитиме _O(log(i))_.

Формат вхідних/вихідних даних
Розроблена програма повинна зчитувати вхідні дані з файлу заданого формату та записувати дані у файл заданого формату. Вхідний файл представляє собою текстовий файл із N+1 рядків, де N — це розмірність вхідного масиву A. Першим записом є число — кількість елементів в масиві; наступні N записів містять елементи вхідного масиву.

Вихідний файл представляє також текстовий файл із N рядків, де кожен рядок i містить медіани для вхідного підмасиву [x1, ..., xi]. Якщо медіана одна, то в рядку буде одне число; якщо медіани дві, то вони записується через пробіл.
До документу завдання також додаються приклади вхідних і вихідних файлів різної розмірності.
Нижче наведені приклади вхідного та вихідного файлу для N = 10.

| Вхідний файл | Вихідний файл |
| :----------: | :-----------: |
|      10      |               |
|      6       |       6       |
|      10      |     6 10      |
|      7       |       7       |
|      1       |      6 7      |
|      4       |       6       |
|      8       |      6 7      |
|      3       |       6       |
|      9       |      6 7      |
|      5       |       6       |
|      2       |      5 6      |
